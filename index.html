<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>AI 聊天 - 微信风格</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="style.css?v=20260109" />
</head>
<body>
    <div class="app">
        <header class="phone-header" id="phoneHeader">
            <button id="btnHeaderBack" class="header-back" aria-label="返回主屏幕">◁</button>
            <div class="phone-status">AA 小手机</div>
            <div class="phone-title" id="phoneTitle">主屏幕</div>
        </header>

        <main class="app-main">
            <!-- 主屏幕：应用图标 -->
            <div id="screenHome" class="screen-view active">
                <div class="home-grid">
                    <button id="iconWechat" class="app-icon wechat">
                        <span class="icon-label">微信</span>
                    </button>
                    <button id="iconSettings" class="app-icon settings">
                        <span class="icon-label">设置</span>
                    </button>
                </div>
            </div>

            <!-- 微信应用：仿微信分布（底部四个 Tab） -->
            <div id="screenChat" class="screen-view">
                <div class="wechat-shell">
                    <div class="wechat-pages">
                        <!-- 微信：会话列表页 -->
                        <div id="wechatPageHome" class="wechat-view active">
                            <div class="wechat-home-list">
                                <div class="wechat-home-search">搜索（占位）</div>
                                <div id="conversationList" class="conversation-list"></div>
                            </div>
                        </div>

                        <!-- 微信：聊天详情页 -->
                        <div id="wechatPageChat" class="wechat-view">
                            <div class="chat-detail-header">
                                <button id="chatBackBtn" class="chat-back-btn">〈 微信</button>
                                <div id="chatDetailName" class="chat-detail-name"></div>
                                <button id="chatProfileBtn" class="chat-profile-btn" title="编辑角色与人设">⋯</button>
                            </div>
                            <div class="chat-scene-bar">
                                <span class="chat-scene-label">场景</span>
                                <select id="sceneSelect" class="chat-scene-select"></select>
                            </div>
                            <section class="chat-area">
                                <div id="panelChat" class="panel panel-chat panel-active">
                                    <div id="chatList" class="chat-list"></div>

                                    <div class="quick-phrases" id="quickPhraseBar">
                                        <button class="quick-phrase-btn" data-text="帮我总结一下今天的聊天内容，简短一点，用要点列出来。">总结今天</button>
                                        <button class="quick-phrase-btn" data-text="请帮我写一条朋友圈，夸夸我今天的表现，用第一人称。">夸夸我</button>
                                        <button class="quick-phrase-btn" data-text="请把我们刚才聊到的事情整理成 3～5 条待办清单。">整理成待办</button>
                                    </div>

                                    <div class="input-area">
                                        <textarea id="userInput" rows="2" placeholder="发送消息…（Ctrl+Enter 换行，Enter 发送）"></textarea>
                                        <button id="sendBtn" class="btn secondary">发送</button>
                                        <button id="askBtn" class="btn primary">让 AI 回复</button>
                                        <button id="retryBtn" class="btn secondary">重说一次</button>
                                    </div>
                                </div>
                            </section>

                            <!-- 聊天详情里的角色设置面板 -->
                            <div id="chatProfileOverlay" class="chat-profile-overlay">
                                <div class="chat-profile-card">
                                    <h3>编辑当前好友与人设</h3>
                                    <label class="form-item">
                                        <span>好友昵称</span>
                                        <input id="chatEditName" type="text" />
                                    </label>
                                    <label class="form-item">
                                        <span>头像（可以填 Emoji 或简单文字）</span>
                                        <input id="chatEditAvatar" type="text" placeholder="例如：🐰、😺 或 https://example.com/avatar.png" />
                                    </label>
                                    <label class="form-item">
                                        <span>角色人设</span>
                                        <textarea id="chatEditPersona" rows="4" placeholder="为这个好友写一段人设说明"></textarea>
                                    </label>
                                    <label class="form-item">
                                        <span>个性签名（资料页中展示，选填）</span>
                                        <input id="chatEditSignature" type="text" placeholder="例如：爱发朋友圈的小伙伴" />
                                    </label>
                                    <label class="form-item">
                                        <span>专属 Base URL（选填，覆盖全局设置）</span>
                                        <input id="chatEditBaseUrl" type="text" placeholder="例如：https://api.openai.com/v1 或 Gemini 的兼容地址" />
                                    </label>
                                    <label class="form-item">
                                        <span>专属模型名（选填）</span>
                                        <input id="chatEditModel" type="text" placeholder="例如：gpt-4.1-mini、gemini-pro 等" />
                                    </label>
                                    <label class="form-item">
                                        <span>温度（选填，0~1，越高越活泼）</span>
                                        <input id="chatEditTemperature" type="number" min="0" max="1" step="0.1" placeholder="默认 0.7" />
                                    </label>
                                    <label class="form-item">
                                        <span>说话风格 / 语气提示</span>
                                        <textarea id="chatEditStyle" rows="3" placeholder="例如：像恋爱向聊天、像温柔老师、像严肃教练等"></textarea>
                                    </label>
                                    <label class="form-item">
                                        <span>选择世界书（可选）</span>
                                        <select id="chatEditWorldBook"></select>
                                    </label>
                                    <label class="form-item">
                                        <span>选择我的人设</span>
                                        <select id="chatEditUserProfile"></select>
                                    </label>
                                    <div class="chat-profile-actions">
                                        <button id="chatProfileCancelBtn" class="btn secondary">取消</button>
                                        <button id="chatProfileSaveBtn" class="btn primary">保存</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                            <!-- 微信：好友资料页 -->
                            <div id="wechatPageProfile" class="wechat-view">
                            <div class="profile-detail-header">
                                <button id="profileBackBtn" class="chat-back-btn">〈 微信</button>
                                <div class="chat-detail-name">详细资料</div>
                            </div>
                            <div class="profile-detail-body">
                                <div class="profile-detail-main">
                                    <div class="profile-detail-avatar" id="profileDetailAvatar"></div>
                                    <div class="profile-detail-name" id="profileDetailName"></div>
                                    <div class="profile-detail-signature" id="profileDetailSignature"></div>
                                </div>
                                <div class="profile-detail-section">
                                    <div class="profile-detail-label">角色人设</div>
                                    <div class="profile-detail-text" id="profileDetailPersona"></div>
                                </div>
                                <div class="profile-detail-section">
                                    <div class="profile-detail-label">标签</div>
                                    <div class="profile-detail-text" id="profileDetailTags"></div>
                                </div>
                                <div class="profile-detail-actions">
                                    <button id="profileChatBtn" class="btn primary">发消息</button>
                                    <button id="profileEditBtn" class="btn secondary">编辑资料</button>
                                </div>
                            </div>
                        </div>

                            <!-- 通讯录：多个角色（好友）的人设管理 -->
                            <div id="wechatPageContacts" class="wechat-view">
                        <div class="contacts">
                            <h2>好友列表</h2>
                            <ul id="charList" class="contact-list"></ul>
                            <div class="contact-form">
                                <h3>添加好友</h3>
                                <label class="form-item">
                                    <span>好友昵称</span>
                                    <input id="newCharName" type="text" placeholder="例如：测试兔兔" />
                                </label>
                                <label class="form-item">
                                    <span>个性签名（选填）</span>
                                    <input id="newCharSignature" type="text" placeholder="例如：一只爱聊天的测试兔兔" />
                                </label>
                                <label class="form-item">
                                    <span>角色人设</span>
                                    <textarea id="newCharPersona" rows="3" placeholder="为这个好友写一段人设说明，例如性格、说话风格、身份等"></textarea>
                                </label>
                                <button id="addCharBtn" class="btn primary">添加好友</button>
                            </div>
                        </div>
                    </div>

                        <!-- 发现：仿微信发现页 + 朋友圈 / 日记子页面 -->
                        <div id="wechatPageDiscover" class="wechat-view">
                            <!-- 发现首页：类似微信“发现”列表 -->
                            <div id="discoverHome" class="discover-view active">
                                <div class="discover-list">
                                    <button id="discoverMomentsEntry" class="discover-item">
                                        <span class="discover-item-icon">◎</span>
                                        <span class="discover-item-text">朋友圈</span>
                                        <span class="discover-item-extra" id="discoverMomentsAvatar"></span>
                                        <span class="discover-item-arrow">›</span>
                                    </button>
                                    <button id="discoverDiaryEntry" class="discover-item">
                                        <span class="discover-item-icon">✎</span>
                                        <span class="discover-item-text">日记本</span>
                                        <span class="discover-item-arrow">›</span>
                                    </button>
                                    <button id="discoverListenEntry" class="discover-item">
                                        <span class="discover-item-icon">♪</span>
                                        <span class="discover-item-text">听一听 / 小程序</span>
                                        <span class="discover-item-arrow">›</span>
                                    </button>
                                </div>
                            </div>

                            <!-- 朋友圈时间线页面 -->
                            <div id="discoverMoments" class="discover-view">
                                <div class="moments-header">
                                    <button id="momentsBackBtn" class="moments-back">〈 发现</button>
                                    <div class="moments-title">朋友圈</div>
                                    <div class="moments-camera">📷</div>
                                    <div class="moments-profile">
                                        <div class="moments-profile-name" id="momentsProfileName">我</div>
                                        <div class="moments-profile-avatar" id="momentsProfileAvatar"></div>
                                    </div>
                                </div>
                                <div class="moments-body">
                                    <div id="momentsList" class="feed-list"></div>
                                    <div class="input-area">
                                        <textarea id="momentHint" rows="2" placeholder="给角色一点灵感（可选），让 TA 用第一人称发一条朋友圈…"></textarea>
                                        <button id="genMomentBtn" class="btn primary">让 TA 发朋友圈</button>
                                        <button id="userMomentBtn" class="btn secondary">我发朋友圈</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 日记本页面 -->
                            <div id="discoverDiary" class="discover-view">
                                <div class="moments-header">
                                    <button id="diaryBackBtn" class="moments-back">〈 发现</button>
                                    <div class="moments-title">日记本</div>
                                    <div class="moments-camera"></div>
                                </div>
                                <div class="moments-body">
                                    <div id="diaryList" class="feed-list"></div>
                                    <div class="input-area">
                                        <textarea id="diaryHint" rows="2" placeholder="给今天的关键词（可选），让 TA 写一篇日记…"></textarea>
                                        <button id="genDiaryBtn" class="btn primary">让 TA 写日记</button>
                                    </div>
                                    <p class="tip">后面我们可以在这里接更多 AI 小玩法，比如今日签、听一听等。</p>
                                </div>
                            </div>
                            <!-- 听一听 / 小程序入口与列表 -->
                            <div id="discoverListen" class="discover-view">
                                <div class="moments-header">
                                    <button id="listenBackBtn" class="moments-back">〈 发现</button>
                                    <div class="moments-title">听一听</div>
                                </div>
                                <div class="moments-body">
                                    <div class="listen-panel">
                                        <p class="tip">基于当前好友、人设和最近聊天，听一听今日一条小建议或歌单文案。</p>
                                        <div class="form-row-inline">
                                            <button id="listenDailySignBtn" class="btn primary">生成今日签</button>
                                            <button id="listenPlaylistBtn" class="btn secondary">生成歌单文案</button>
                                        </div>
                                        <label class="form-item">
                                            <span>补充一点想说的话（可选）</span>
                                            <textarea id="listenHint" rows="2" placeholder="例如：最近有点丧 / 想听元气一点的歌"></textarea>
                                        </label>
                                        <div id="listenResult" class="listen-result"></div>
                                    </div>
                                    <div class="miniapp-section">
                                        <h3>小程序（预留）</h3>
                                        <ul id="miniAppList" class="miniapp-list">
                                            <li class="miniapp-item">
                                                <button id="miniAppTarotBtn" class="btn secondary" style="width:100%;text-align:left;justify-content:space-between;display:flex;align-items:center;">
                                                    <span>塔罗占卜</span>
                                                    <span style="font-size:12px;color:#999;">抽一张今日塔罗</span>
                                                </button>
                                            </li>
                                            <li class="miniapp-item">
                                                <button id="miniAppMoodTestBtn" class="btn secondary" style="width:100%;text-align:left;justify-content:space-between;display:flex;align-items:center;">
                                                    <span>情绪小测试</span>
                                                    <span style="font-size:12px;color:#999;">测一下现在的心情</span>
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 我：用户人设 + 自动生成开关 -->
                        <div id="wechatPageMe" class="wechat-view">
                        <div class="wechat-settings">
                            <h2>我的人设</h2>
                            <ul id="userProfileList" class="profile-list"></ul>
                            <div class="profile-form">
                                <h3>新增人设</h3>
                                <label class="form-item">
                                    <span>昵称</span>
                                    <input id="newUserName" type="text" placeholder="例如：窝窝" />
                                </label>
                                <label class="form-item">
                                    <span>头像（可以填 Emoji 或 URL）</span>
                                    <input id="newUserAvatar" type="text" placeholder="例如：🐻 或 https://example.com/me.png" />
                                </label>
                                <label class="form-item">
                                    <span>用户人设</span>
                                    <textarea id="newUserPersona" rows="3" placeholder="为自己写一段人设说明，例如性格、生活状态、爱好等"></textarea>
                                </label>
                                <button id="addUserProfileBtn" class="btn primary">添加人设</button>
                            </div>
                            <div class="form-row-inline">
                                <label class="switch-row">
                                    <input id="autoMoments" type="checkbox" />
                                    <span>聊天后自动生成一条朋友圈</span>
                                </label>
                            </div>
                            <div class="form-row-inline">
                                <label class="switch-row">
                                    <input id="autoDiary" type="checkbox" />
                                    <span>聊天后自动生成一篇日记</span>
                                </label>
                            </div>

                            <div class="memory-center">
                                <h2>记忆管理中心</h2>
                                <label class="form-item">
                                    <span>当前记忆摘要（可手动编辑）</span>
                                    <textarea id="memorySummaryInput" rows="4" placeholder="这里会显示 AI 对你长期聊天的总结，用来让对话更连续。你也可以自己写或修改。"></textarea>
                                </label>
                                <div class="form-row-inline">
                                    <button id="saveMemorySummaryBtn" class="btn primary">保存记忆修改</button>
                                    <button id="clearMemorySummaryBtn" class="btn secondary">一键清空记忆</button>
                                </div>
                                <p class="tip">清空记忆会让 AI 忘记之前自动总结的长期信息，但不会删除聊天记录本身。</p>
                            </div>

                            <h2>世界书（世界观设定）</h2>
                            <ul id="worldBookList" class="profile-list"></ul>
                            <div class="profile-form">
                                <h3>新增世界书</h3>
                                <label class="form-item">
                                    <span>世界书名称</span>
                                    <input id="newWorldBookName" type="text" placeholder="例如：架空都市·夜之城" />
                                </label>
                                <label class="form-item">
                                    <span>世界规则 / 关键设定</span>
                                    <textarea id="newWorldBookContent" rows="4" placeholder="例如：世界观规则、阵营设定、禁忌、破甲词、常见地名与组织等"></textarea>
                                </label>
                                <button id="addWorldBookBtn" class="btn primary">添加世界书</button>
                                <p class="tip">世界书会作为额外设定注入到与角色的对话中，帮助 AI 理解这个架空世界。</p>
                            </div>
                        </div>
                    </div>
                    </div>

                    <!-- 底部微信 Tab 栏：微信 / 通讯录 / 发现 / 我 -->
                    <div class="wechat-bottom-bar">
                        <button id="wechatTabHome" class="wechat-bottom-item active">
                            <span class="wechat-bottom-icon">●</span>
                            <span class="wechat-bottom-label">微信</span>
                        </button>
                        <button id="wechatTabContacts" class="wechat-bottom-item">
                            <span class="wechat-bottom-icon">●</span>
                            <span class="wechat-bottom-label">通讯录</span>
                        </button>
                        <button id="wechatTabDiscover" class="wechat-bottom-item">
                            <span class="wechat-bottom-icon">●</span>
                            <span class="wechat-bottom-label">发现</span>
                        </button>
                        <button id="wechatTabMe" class="wechat-bottom-item">
                            <span class="wechat-bottom-icon">●</span>
                            <span class="wechat-bottom-label">我</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 系统设置应用：仅管理 API 配置 -->
            <div id="screenSettings" class="screen-view">
                <aside class="settings full">
                    <h2>API 设置</h2>
                    <label class="form-item">
                        <span>Base URL</span>
                        <input id="baseUrl" type="text" placeholder="默认：https://api.openai.com/v1" />
                    </label>
                    <label class="form-item">
                        <span>API Key</span>
                        <input id="apiKey" type="password" placeholder="在这里填你的 API Key" />
                    </label>
                    <div class="form-row-inline">
                        <button id="fetchModelsBtn" class="btn secondary">拉取模型列表</button>
                        <span class="inline-tip">会请求 Base URL 下的 /models 接口</span>
                    </div>
                    <label class="form-item">
                        <span>选择模型</span>
                        <select id="modelSelect"></select>
                    </label>
                    <label class="form-item">
                        <span>自定义模型名（可选，优先使用）</span>
                        <input id="modelCustom" type="text" placeholder="如果你的接口模型名和列表不一样，可在这里手动填" />
                    </label>
                    <h2>AI 记忆力</h2>
                    <div class="form-row-inline">
                        <label class="switch-row">
                            <input id="memoryEnabled" type="checkbox" />
                            <span>开启 AI 记忆力（自动总结聊天要点）</span>
                        </label>
                    </div>
                    <label class="form-item">
                        <span>每多少条 AI 回复后进行一次总结</span>
                        <input id="memoryEvery" type="number" min="3" max="100" step="1" placeholder="例如：20" />
                    </label>
                    <button id="saveSettingsBtn" class="btn primary">保存设置（本机浏览器）</button>
                    <p class="tip">提示：设置会保存在当前浏览器的本地存储中，不会上传到服务器。</p>

                    <h2>数据备份与恢复</h2>
                    <div class="form-row-inline">
                        <button id="exportDataBtn" class="btn secondary">导出数据（聊天 / 朋友圈 / 日记）</button>
                    </div>
                    <div class="form-row-inline">
                        <button id="importDataBtn" class="btn secondary">从文件导入数据</button>
                        <input id="importFile" type="file" accept="application/json" style="display:none" />
                    </div>
                    <p class="tip">导入会覆盖当前浏览器中的全部小手机数据，操作前请先导出备份。</p>
                </aside>
            </div>
        </main>

        <footer class="phone-footer">
            <button id="btnHome" class="home-btn">◁ 主屏幕</button>
        </footer>
        <!-- 消息长按操作菜单 -->
        <div id="msgActionOverlay" class="msg-action-overlay">
            <div class="msg-action-mask"></div>
            <div class="msg-action-sheet">
                <button class="msg-action-btn" data-action="copy">复制</button>
                <button class="msg-action-btn" data-action="star">标为星标消息</button>
                <button class="msg-action-btn" data-action="moment">从此生成朋友圈</button>
                <button class="msg-action-btn msg-action-danger" data-action="delete">删除</button>
                <button class="msg-action-btn msg-action-cancel" data-action="cancel">取消</button>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>
